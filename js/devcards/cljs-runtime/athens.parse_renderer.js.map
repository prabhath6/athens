{"version":3,"sources":["athens/parse_renderer.cljs"],"mappings":"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","names":["athens.parse-renderer/transform","tree","G__52759","G__52760","instaparse.core/transform","contents","cljs.core.concat.cljs$core$IFn$_invoke$arity$2","title","node","G__52761","G__52762","G__52763","posh.reagent/pull","athens.db/dsdb","athens.router/navigate-page","cljs.core/deref","uid","block","G__52764","G__52765","G__52766","G__52767","athens.parse-renderer/parse-and-render","tag-name","G__52768","G__52769","G__52770","p__52771","map__52772","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","url","alt","p__52774","map__52775","text","string","result","athens.parser/parse-to-ast","instaparse.core/failure?","cljs.core.pr_str.cljs$core$IFn$_invoke$arity$variadic","instaparse.core/get-failure","cljs.core/vec"],"sourcesContent":["(ns athens.parse-renderer\n  (:require\n    [athens.db :as db]\n    [athens.parser :as parser]\n    [athens.router :refer [navigate-page]]\n    [instaparse.core :as insta]\n    [posh.reagent :refer [pull #_q]]))\n\n\n(declare parse-and-render)\n\n\n;; Instaparse transforming docs: https://github.com/Engelberg/instaparse#transforming-the-tree\n(defn transform\n  \"Transforms Instaparse output to Hiccup.\"\n  [tree]\n  (insta/transform\n    {:block     (fn [& contents]\n                  (concat [:span {:class \"block\"}] contents))\n     :page-link (fn [title]\n                  (let [node (pull db/dsdb '[*] [:node/title title])]\n                    [:span {:class \"page-link\"}\n                     [:span {:style {:color \"gray\"}} \"[[\"]\n                     [:span {:on-click #(navigate-page (:block/uid @node))\n                             :style    {:text-decoration \"none\" :color \"dodgerblue\"}} title]\n                     [:span {:style {:color \"gray\"}} \"]]\"]]))\n     :block-ref (fn [uid]\n                  (let [block (pull db/dsdb '[*] [:block/uid uid])]\n                    [:span {:class \"block-ref\"\n                            :style {:font-size \"0.9em\" :border-bottom \"1px solid gray\"}}\n                     [:span {:on-click #(navigate-page uid)} (parse-and-render (:block/string @block))]]))\n     :hashtag   (fn [tag-name]\n                  (let [node (pull db/dsdb '[*] [:node/title tag-name])]\n                    [:span {:class    \"hashtag\"\n                            :style    {:color \"gray\" :text-decoration \"none\" :font-weight \"bold\"}\n                            :on-click #(navigate-page (:block/uid @node))}\n                     (str \"#\" tag-name)]))\n     :url-image (fn [{url :url alt :alt}]\n                  [:img {:class \"url-image\"\n                         :alt   alt\n                         :src   url}])\n     :url-link  (fn [{url :url} text]\n                  [:a {:class \"url-link\"\n                       :href  url}\n                   text])\n     :bold      (fn [text]\n                  [:strong {:class \"bold\"} text])}\n    tree))\n\n\n(defn parse-and-render\n  \"Converts a string of block syntax to Hiccup, with fallback formatting if it can\u2019t be parsed.\"\n  [string]\n  (let [result (parser/parse-to-ast string)]\n    (if (insta/failure? result)\n      [:span\n       {:title (pr-str (insta/get-failure result))\n        :style {:color \"red\"}}\n       string]\n      [vec (transform result)])))\n"]}