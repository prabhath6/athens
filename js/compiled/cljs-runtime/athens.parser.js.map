{"version":3,"sources":["athens/parser.cljc"],"mappings":";;;AAMA,AAAA,AAKA,AAAA,AAAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAAF,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAWG;AAkCX;;;;AAAA,AAAMC,AAGHC;AAHH,AAIE,AAACC,AACC,AAAKC,AAAgBC;AAArB,AACE,AAAI,AAAK,AAASA,AAAM,AAAS,AAACC,AAAKF;AACrC,AAAMG,AAAkB,AAACC,AAAIJ;AACvBK,AAAqB,AAAK,AAACH,AAAKF,AAAiBC;AADvD,AAEE,AAACK,AAAKH,AAAkBE;;AAC1B,AAACC,AAAKN,AAAgBC;;AAN5B,AAQEH;;AAGJ;;;AAAA,AAAMS,AAEHC;AAFH,AAGE,AAAAC,AAAA,AAAA,AAC2B;AAAOG;AAAP,AAEE,AAAA,AAAA,AAACC,AAAc,AAAChB,AAAyBe;;;AAFpCA;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;AADlC,AAI2B,AAAKE,AAAcC;AAAnB,AACE,AAAA,AAAA,AAAA,AAAA,AAACF,AAAsBE,AAAMD;AAL1D,AAM2B;AAAOF;AAAP,AACE,AAACf,AAAyBe;;;AADrBA;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;AANlC,AAQ2B;AAAOI;AAAP,AACE,AAACC,AAAoBD;;;AADhBA;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;AARlC,AAU2B;AAAOA;AAAP,AACE,AAACC,AAAoBD;;;AADhBA;;;;AAAAA;;AAAAA;;;AAAAA;AAAAA;;;;;;AAVlCN,AAYEF;AAZF,AAAA,AAAAC,AAAAC,AAAAD,AAAAC,AAACC,AAAAA,AAAAA;;AAeH;;;AAAA,AAAMO,AAEHC;AAFH,AAGE,AAACZ,AAAiB,AAACX,AAAAA,AAAAA,AAAauB,AAAAA","names":["instaparse.core/map->Parser","instaparse.core.parser.cljs$core$IFn$_invoke$arity$variadic","cljs.core/List","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","instaparse.combinators-source/regexp","athens.parser/block-parser","athens.parser/combine-adjacent-strings","coll","cljs.core.reduce.cljs$core$IFn$_invoke$arity$3","elements-so-far","elmt","cljs.core/peek","previous-elements","cljs.core/pop","combined-last-string","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","athens.parser/transform-to-ast","tree","G__53116","G__53117","instaparse.core/transform","raw-contents","cljs.core.into.cljs$core$IFn$_invoke$arity$2","text-contents","url","chars","clojure.string.join.cljs$core$IFn$_invoke$arity$1","athens.parser/parse-to-ast","string"],"sourcesContent":["(ns athens.parser\n  (:require\n    #?(:cljs [instaparse.core :as insta :refer-macros [defparser]]\n       :clj [instaparse.core :as insta :refer [defparser]])))\n\n\n(declare block-parser)\n\n\n;; Instaparse docs: https://github.com/Engelberg/instaparse#readme\n\n(defparser block-parser\n  \"(* This first rule is the top-level one. *)\n   block = ( syntax-in-block / any-char )*\n   (* `/` ordered alternation is used to, for example, try to interpret a string beginning with '[[' as a page-link before interpreting it as raw characters. *)\n   \n   <syntax-in-block> = (page-link | block-ref | hashtag | url-link | bold)\n   \n   page-link = <'[['> any-chars <']]'>\n   \n   block-ref = <'(('> #'[a-zA-Z0-9_\\\\-]+' <'))'>\n   \n   hashtag = hashtag-bare | hashtag-delimited\n   <hashtag-bare> = <'#'> #'[\\\\p{L}\\\\p{M}\\\\p{N}_]+'  (* Unicode: L = letters, M = combining marks, N = numbers *)\n   <hashtag-delimited> = <'#'> <'[['> #'[^\\\\]]+' <']]'>\n   \n   url-link = url-link-text url-link-url\n   <url-link-text> = <'['> url-link-text-contents <']'>\n   url-link-text-contents = ( (bold | backslash-escaped-right-bracket) / any-char )*\n   <backslash-escaped-right-bracket> = <'\\\\\\\\'> ']'\n   <url-link-url> = <'('> url-link-url-parts <')'>\n   url-link-url-parts = url-link-url-part+\n   <url-link-url-part> = (backslash-escaped-paren | '(' url-link-url-part* ')') / any-char\n   <backslash-escaped-paren> = <'\\\\\\\\'> ('(' | ')')\n   \n   bold = <'**'> any-chars <'**'>\n   \n   (* It\u2019s useful to extract this rule because its transform joins the individual characters everywhere it\u2019s used. *)\n   (* However, I think in many cases a more specific rule can be used. So we will migrate away from uses of this rule. *)\n   any-chars = any-char+\n   \n   <any-char> = #'\\\\w|\\\\W'\n   \")\n\n\n(defn combine-adjacent-strings\n  \"In a sequence of strings mixed with other values, returns the same sequence with adjacent strings concatenated.\n   (If the sequence contains only strings, use clojure.string/join instead.)\"\n  [coll]\n  (reduce\n    (fn [elements-so-far elmt]\n      (if (and (string? elmt) (string? (peek elements-so-far)))\n        (let [previous-elements (pop elements-so-far)\n              combined-last-string (str (peek elements-so-far) elmt)]\n          (conj previous-elements combined-last-string))\n        (conj elements-so-far elmt)))\n    []\n    coll))\n\n\n(defn transform-to-ast\n  \"Transforms the Instaparse output tree to an abstract syntax tree for Athens markup.\"\n  [tree]\n  (insta/transform\n    {:block                  (fn [& raw-contents]\n                                ;; use combine-adjacent-strings to collapse individual characters from any-char into one string\n                               (into [:block] (combine-adjacent-strings raw-contents)))\n     :url-link               (fn [text-contents url]\n                               (into [:url-link {:url url}] text-contents))\n     :url-link-text-contents (fn [& raw-contents]\n                               (combine-adjacent-strings raw-contents))\n     :url-link-url-parts     (fn [& chars]\n                               (clojure.string/join chars))\n     :any-chars              (fn [& chars]\n                               (clojure.string/join chars))}\n    tree))\n\n\n(defn parse-to-ast\n  \"Converts a string of block syntax to an abstract syntax tree for Athens markup.\"\n  [string]\n  (transform-to-ast (block-parser string)))\n"]}