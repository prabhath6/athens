{"version":3,"sources":["athens/devcards/node_page.cljs"],"mappings":"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","names":["athens.devcards.node-page/title-style","athens.style.color.cljs$core$IFn$_invoke$arity$1","garden.selectors/+","athens.devcards.node-page/handler","val","uid","G__89836","re-frame.core/dispatch","athens.devcards.node-page/db-handler","goog.functions/debounce","p__89837","map__89838","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","athens.devcards.node-page/node-page-el","children","title","editing-uid","linked-refs","unlinked-refs","stylefy.core.use_style.cljs$core$IFn$_invoke$arity$2","komponentit.autosize/textarea","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","e","G__89840","G__89841","iter__4582__auto__","s__89843","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4580__auto__","size__4581__auto__","cljs.core/count","b__89845","cljs.core/chunk-buffer","i__89844","cljs.core._nth.cljs$core$IFn$_invoke$arity$2","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__89842","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","child","athens.devcards.blocks/block-el","s__89847","b__89849","i__89848","iter__89846","ref","s__89851","b__89853","i__89852","iter__89850","athens.devcards.node-page/node-page-component","ident","cljs.core/deref","node","posh.reagent/pull","athens.db/dsdb","athens.db/node-pull-pattern","athens.db/sort-block","G__89855","re-frame.core/subscribe","clojure.string/blank?","linked-ref-entids","G__89856","G__89857","G__89858","posh.reagent/q","athens.db/q-refs","athens.patterns/linked","unlinked-ref-entids","G__89859","G__89860","G__89861","athens.patterns/unlinked","cljs.core/chunk-first"],"sourcesContent":["(ns athens.devcards.node-page\r\n  (:require\r\n    [athens.db :as db]\r\n    [athens.devcards.blocks :as blocks]\r\n    [athens.patterns :as patterns]\r\n    [athens.style :refer [color]]\r\n    [cljsjs.react]\r\n    [cljsjs.react.dom]\r\n    [clojure.string :as string]\r\n    [devcards.core :refer-macros [defcard-rg]]\r\n    [garden.selectors :as selectors]\r\n    [goog.functions :refer [debounce]]\r\n    [komponentit.autosize :as autosize]\r\n    [posh.reagent :refer [pull q]]\r\n    [re-frame.core :refer [dispatch subscribe]]\r\n    [stylefy.core :as stylefy :refer [use-style]]))\r\n\r\n\r\n;;; Styles\r\n\r\n(def title-style\r\n  {:position \"relative\"\r\n   :overflow \"visible\"\r\n   :flex-grow \"1\"\r\n   :margin \"0.2em 0\"\r\n   :letter-spacing \"-0.03em\"\r\n   :word-break \"break-word\"\r\n   ::stylefy/manual [[:textarea {:display \"none\"}]\r\n                     [:&:hover [:textarea {:display \"block\"\r\n                                           :z-index 1}]]\r\n                     [:textarea {:-webkit-appearance \"none\"\r\n                                 :cursor \"text\"\r\n                                 :resize \"none\"\r\n                                 :transform \"translate3d(0,0,0)\"\r\n                                 :color \"inherit\"\r\n                                 :font-weight \"inherit\"\r\n                                 :padding \"0\"\r\n                                 :letter-spacing \"inherit\"\r\n                                 :position \"absolute\"\r\n                                 :top \"0\"\r\n                                 :left \"0\"\r\n                                 :right \"0\"\r\n                                 :width \"100%\"\r\n                                 :min-height \"100%\"\r\n                                 :caret-color (color :link-color)\r\n                                 :background \"transparent\"\r\n                                 :margin \"0\"\r\n                                 :font-size \"inherit\"\r\n                                 :line-height \"inherit\"\r\n                                 :border-radius \"4px\"\r\n                                 :transition \"opacity 0.15s ease\"\r\n                                 :border \"0\"\r\n                                 :opacity \"0\"\r\n                                 :font-family \"inherit\"}]\r\n                     [:textarea:focus\r\n                      :.is-editing {:outline \"none\"\r\n                                    :z-index \"10\"\r\n                                    :display \"block\"\r\n                                    :opacity \"1\"}]\r\n                     [(selectors/+ :.is-editing :span) {:opacity 0}]]})\r\n\r\n\r\n;;; Helpers\r\n\r\n\r\n(defn handler\r\n  [val uid]\r\n  (dispatch [:transact-event [[:db/add [:block/uid uid] :node/title val]]]))\r\n\r\n\r\n(def db-handler (debounce handler 500))\r\n\r\n\r\n;;; Components\r\n\r\n\r\n(defn node-page-el\r\n  [{:block/keys [children uid] title :node/title} editing-uid linked-refs unlinked-refs]\r\n  [:div\r\n\r\n   ;; Header\r\n   [:h1 (use-style title-style {:data-uid uid :class \"page-header\"})\r\n    [autosize/textarea\r\n     {:default-value title\r\n      :class      (when (= editing-uid uid) \"is-editing\")\r\n      :auto-focus true\r\n      :on-change  (fn [e] (db-handler (.. e -target -value) uid))}]\r\n    [:span title]]\r\n\r\n   [:div\r\n    (for [child children]\r\n      ^{:key (:db/id child)} [blocks/block-el child])]\r\n   ;; TODO references\r\n   [:div\r\n    [:h4 \"Linked References\"]\r\n    (for [ref linked-refs]\r\n      ^{:key ref} [:p ref])]\r\n   [:div\r\n    [:h4 \"Unlinked References\"]\r\n    (for [ref unlinked-refs]\r\n      ^{:key ref} [:p ref])]])\r\n\r\n\r\n(defn node-page-component\r\n  \"One diff between datascript and posh: we don't have pull in q for posh\r\n  https://github.com/mpdairy/posh/issues/21\"\r\n  [ident]\r\n  (let [node (->> @(pull db/dsdb db/node-pull-pattern ident) (db/sort-block))\r\n        title (:node/title node)\r\n        editing-uid @(subscribe [:editing-uid])]\r\n    (when-not (string/blank? title)\r\n      (let [linked-ref-entids     @(q db/q-refs db/dsdb (patterns/linked title))\r\n            unlinked-ref-entids   @(q db/q-refs db/dsdb (patterns/unlinked title))]\r\n        [node-page-el node editing-uid linked-ref-entids unlinked-ref-entids]))))\r\n\r\n\r\n;;; Devcards\r\n\r\n\r\n(defcard-rg Node-Page\r\n  \"pull entity 4093: \\\"Hyperlink\\\" page\"\r\n  [node-page-component 4093])\r\n"]}