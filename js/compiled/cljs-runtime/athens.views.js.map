{"version":3,"sources":["athens/views.cljs"],"mappings":";;;;;;;;;;;;;;;AAoBA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKA;AAUL,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKC;AAML,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKC;AAQL;;;AAAA,AAAMC;AAAN,AAGE,AAAMC,AAAO,AAAAC,AAAA,AAAA;AAAA,AAAA,AAAAA,AAAAA,AAACC,AAAAA,AAAAA;;AAAd,AACE,AAAM,AAAA,AAAAC,AAACC,AAAKJ;AAAZ,AACE,AAACK,AAAS,AAAA,AAAAF,AAAMH;;AAChB,AAAAM,AAAA,AAAA;AAAA,AAAA,AAAAA,AAAAA,AAACC,AAAAA,AAAAA;;AAFH;;;AAKJ,AAAA,AAAMC,AACHC;AADH,AAEE,AAAMC,AAAG,AAAAC;AACHC,AAAK,AAAA,AAAA,AAAA,AAAIH;AADf,AAEE,AAAA,AAAAI,AAAM,AAAUH;AAAhB,AAAqB,AAAAI,AAAA,AAAA,AAAyB,AAAA,AAAAD;AAAzB,AAAA,AAAAC,AAAAA,AAACP,AAAAA,AAAAA;;;AACtB,AAAaG,AAAGE;;AAMpB,AAAA,AAAMG;AAAN,AAAA,AAAA,AAAA,AAAA,AAAA;;AAMA,AAAA,AAAMC;AAAN,AAEE;AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAMkC,AAAKP;AAAL,AAAQ,AAACD,AAAQC;AANnD,AAOIQ,AAAMC;;;AAGZ,AAAA,AAAMC;AAAN,AAEE,AAAMC,AAAc,AAAAC,AAAA,AAAA;AAAA,AAAA,AAAAA,AAAAA,AAACnB,AAAAA,AAAAA;;AACfoB,AAAc,AAAA,AAAA,AAAA,AAAA,AAAAnB,AAAKiB;AADzB,AAAAjB,AAEMoB,AAAe,AAAAC,AAAMN;AAANO,AAAA,AAAA;AAAAC,AAAA,AAAA,AAA+BJ;AAA/B,AAAA,AAAAE,AAAAC,AAAAC,AAAAF,AAAAC,AAAAC,AAACC,AAAAA,AAAAA;;AAFtB,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAIG,AAAA,AAAA,AAAI,AAAA,AAAaJ,AACdK,AAAoB,AAAA,AAAQL,AAC5BM,AAAqB,AAAA,AAAQN;;AAGrC,AAAA,AAAMO,AACHC;AADH,AAAA,AAAA,AAAA,AAEQ,AAACC,AAAUnC,AACf,AAAAoC,AAAMF;AAANE,AAAA,AAAA,AAAAA,AAAAC,AAAA,AAAAD,AAAA;AAAA,AAAA,AAAAA;AAAA;AACSlB;;;AADT;AAESC;;;AAFT;AAGQG;;;;AACNH;;;;;AAGN,AAAA,AAAMmB;AAAN,AAEE,AAAMf,AAAc,AAAAgB,AAAA,AAAA;AAAA,AAAA,AAAAA,AAAAA,AAAClC,AAAAA,AAAAA;;AACfmC,AAAQ,AAAAC,AAAA,AAAA;AAAA,AAAA,AAAAA,AAAAA,AAACpC,AAAAA,AAAAA;;AADf,AAEE;AAAA,AAAA,AAAA,AAAA,AAAA,AAEIH,AACAwC,AACD,AAAA,AAAApC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKkC,AACFG,AACK,AAACR,AAAUpC,AACf6C,AACK,AAACT,AAAUlC,AACfgC,AAAY,AAAA,AAAA,AAAA,AAAA,AAAA3B,AAAKiB,AAClBsB,AACAC","names":["athens.views/app-wrapper-style","athens.views/match-panel-style","athens.views/main-content-style","athens.views/alert","errors","G__58109","re-frame.core/subscribe","cljs.core/deref","cljs.core/seq","js/alert","G__58111","re-frame.core/dispatch","athens.views/file-cb","e","fr","js/FileReader","file","p1__58112#","G__58113","athens.views/about-panel","athens.views/pages-panel","athens.devcards.all-pages/table","athens.db/dsdb","athens.views/page-panel","current-route","G__58115","uid","node-or-block","G__58116","G__58117","G__58118","posh.reagent/pull","athens.devcards.node-page/node-page-component","athens.devcards.block-page/block-page-component","athens.views/match-panel","name","stylefy.core.use_style.cljs$core$IFn$_invoke$arity$1","G__58119","cljs.core/Keyword","athens.views/main-panel","G__58120","loading","G__58121","athens.devcards.athena/athena-component","athens.devcards.spinner/initial-spinner-component","athens.devcards.left-sidebar/left-sidebar","athens.devcards.right-sidebar/right-sidebar-component","athens.devcards.devtool/devtool-component"],"sourcesContent":["(ns athens.views\r\n  (:require\r\n    [athens.db :as db]\r\n    [athens.devcards.all-pages :refer [table]]\r\n    [athens.devcards.athena :refer [athena-component]]\r\n    [athens.devcards.block-page :refer [block-page-component]]\r\n    [athens.devcards.devtool :refer [devtool-component]]\r\n    [athens.devcards.left-sidebar :refer [left-sidebar]]\r\n    [athens.devcards.node-page :refer [node-page-component]]\r\n    [athens.devcards.right-sidebar :refer [right-sidebar-component]]\r\n    [athens.devcards.spinner :refer [initial-spinner-component]]\r\n    [athens.subs]\r\n    [posh.reagent :refer [pull]]\r\n    [re-frame.core :refer [subscribe dispatch]]\r\n    [stylefy.core :refer [use-style]]))\r\n\r\n\r\n;;; Styles\r\n\r\n\r\n(def app-wrapper-style\r\n  {:display \"grid\"\r\n   :grid-template-areas\r\n   \"'left-sidebar main-content secondary-content'\r\n   'devtool devtool devtool'\"\r\n   :grid-template-columns \"auto 1fr auto\"\r\n   :grid-template-rows \"1fr auto\"\r\n   :height \"100vh\"})\r\n\r\n\r\n(def match-panel-style\r\n  {:margin \"5rem auto\"\r\n   :min-width \"500px\"\r\n   :max-width \"900px\"})\r\n\r\n\r\n(def main-content-style\r\n  {:flex \"1 1 100%\"\r\n   :overflow-y \"auto\"})\r\n\r\n\r\n;;; Components\r\n\r\n\r\n(defn alert\r\n  \"When `:errors` subscription is updated, global alert will be called with its contents and then cleared.\"\r\n  []\r\n  (let [errors (subscribe [:errors])]\r\n    (when (seq @errors)\r\n      (js/alert (str @errors))\r\n      (dispatch [:clear-errors]))))\r\n\r\n\r\n(defn file-cb\r\n  [e]\r\n  (let [fr (js/FileReader.)\r\n        file (.. e -target -files (item 0))]\r\n    (set! (.-onload fr) #(dispatch [:parse-datoms (.. % -target -result)]))\r\n    (.readAsText fr file)))\r\n\r\n\r\n;; Panels\r\n\r\n\r\n(defn about-panel\r\n  []\r\n  [:div\r\n   [:h1 \"About Panel\"]])\r\n\r\n\r\n(defn pages-panel\r\n  []\r\n  (fn []\r\n    [:div\r\n     [:p\r\n      \"Upload your DB \" [:a {:href \"\"} \"(tutorial)\"]]\r\n     [:input.input-file {:type      \"file\"\r\n                         :name      \"file-input\"\r\n                         :on-change (fn [e] (file-cb e))}]\r\n     [table db/dsdb]]))\r\n\r\n\r\n(defn page-panel\r\n  []\r\n  (let [current-route (subscribe [:current-route])\r\n        uid           (-> @current-route :path-params :id)\r\n        node-or-block @(pull db/dsdb '[*] [:block/uid uid])]\r\n    [:div {:style {:margin-left \"40px\" :margin-right \"40px\"}}\r\n     (if (:node/title node-or-block)\r\n       [node-page-component (:db/id node-or-block)]\r\n       [block-page-component (:db/id node-or-block)])]))\r\n\r\n\r\n(defn match-panel\r\n  [name]\r\n  [:div (use-style match-panel-style)\r\n   [(case name\r\n      :about about-panel\r\n      :pages pages-panel\r\n      :page page-panel\r\n      pages-panel)]])\r\n\r\n\r\n(defn main-panel\r\n  []\r\n  (let [current-route (subscribe [:current-route])\r\n        loading (subscribe [:loading])]\r\n    (fn []\r\n      [:<>\r\n       [alert]\r\n       [athena-component]\r\n       (if @loading\r\n         [initial-spinner-component]\r\n         [:div (use-style app-wrapper-style)\r\n          [left-sidebar]\r\n          [:div (use-style main-content-style)\r\n           [match-panel (-> @current-route :data :name)]]\r\n          [right-sidebar-component]\r\n          [devtool-component]])])))\r\n"]}